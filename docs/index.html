<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Test Runner</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Vue App Container -->
    <div id="app" v-cloak>
        <div class="container">
            <header>
                <h1>üöÄ Performance Test Runner</h1>
                <p class="subtitle">Configure and trigger performance tests</p>
                <p class="version">{{ version }}</p>
            </header>

            <main>
                <!-- Configuration Form -->
                <section class="config-section">
                    <h2>Test Configuration</h2>

                    <!-- Loading State -->
                    <div v-if="configLoading" class="loading-state">
                        <p>‚è≥ Loading configuration...</p>
                    </div>

                    <!-- Error State -->
                    <div v-else-if="configError" class="error-state">
                        <p>‚ùå Failed to load configuration</p>
                        <p class="error-message">{{ configError }}</p>
                        <button class="btn btn-secondary" @click="loadConfiguration">
                            üîÑ Retry
                        </button>
                    </div>

                    <!-- Configuration Form -->
                    <form @submit.prevent="handleSubmit" v-else>

                        <!-- ========================================
                             SELECTION DROPDOWNS
                             ======================================== -->

                        <!-- Load Type Selection -->
                        <div class="form-group">
                            <label for="load-type">
                                Load Type <span class="required">*</span>
                            </label>
                            <select id="load-type" v-model="selection.loadType" required>
                                <option value="">-- Select Load Type --</option>
                                <option v-for="(config, key) in testConfig.loadConfig" :key="key" :value="key">
                                    {{ config.label }}
                                </option>
                            </select>
                            <small v-if="selectedLoadConfig">
                                {{ selectedLoadConfig.description }}
                            </small>
                        </div>

                        <!-- ========================================
                             DYNAMIC LOAD CONFIGURATION FIELDS
                             ======================================== -->

                        <div v-if="loadConfigFields.length > 0" class="field-group">
                            <h3 class="field-group-title">
                                üìä Load Configuration
                            </h3>

                            <div class="field-group-content">
                                <div v-for="field in loadConfigFields" :key="field.name"
                                    :class="['form-group', field.type === 'checkbox' ? 'checkbox-group' : '']">
                                    <!-- Number Input -->
                                    <template v-if="field.type === 'number'">
                                        <label :for="'load-' + field.name">
                                            {{ field.label }}
                                            <span v-if="field.unit" class="field-unit">({{ field.unit }})</span>
                                            <span class="required">*</span>
                                        </label>
                                        <input :id="'load-' + field.name" type="number"
                                            v-model.number="loadData[field.name]" :min="field.min" required>
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>

                                    <!-- Text Input -->
                                    <template v-if="field.type === 'text' || field.type === 'string'">
                                        <label :for="'load-' + field.name">
                                            {{ field.label }}
                                            <span class="required">*</span>
                                        </label>
                                        <input :id="'load-' + field.name" type="text" v-model="loadData[field.name]"
                                            required>
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>

                                    <!-- Checkbox -->
                                    <template v-if="field.type === 'checkbox' || field.type === 'boolean'">
                                        <label :for="'load-' + field.name" class="checkbox-label">
                                            <input :id="'load-' + field.name" type="checkbox"
                                                v-model="loadData[field.name]">
                                            <span class="checkbox-text">{{ field.label }}</span>
                                        </label>
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>
                                </div>

                                <!-- Validation Errors -->
                                <div v-if="validationErrors.load.length > 0" class="validation-errors">
                                    <p v-for="(error, index) in validationErrors.load" :key="index">
                                        ‚ö†Ô∏è {{ error }}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- ========================================
                             ENVIRONMENT & URL
                             ======================================== -->

                        <!-- Environment Selection -->
                        <div class="form-group">
                            <label for="environment">
                                Environment <span class="required">*</span>
                            </label>
                            <select id="environment" v-model="selection.environment" required>
                                <option value="">-- Select Environment --</option>
                                <option v-for="(config, key) in testConfig.environment" :key="key" :value="key">
                                    {{ config.label }}
                                </option>
                            </select>
                            <small v-if="selectedEnvironment && selectedEnvironment.warning" class="warning-text">
                                {{ selectedEnvironment.warning }}
                            </small>
                        </div>

                        <!-- Target URL Selection -->
                        <div class="form-group" v-if="availableUrls.length > 0">
                            <label for="target-url">
                                Target URL <span class="required">*</span>
                            </label>
                            <select id="target-url" v-model="selection.targetUrl" required>
                                <option value="">-- Select URL --</option>
                                <option v-for="url in availableUrls" :key="url" :value="url">
                                    {{ url }}
                                </option>
                            </select>
                            <small>URL endpoint to test</small>
                        </div>

                        <!-- ========================================
                             SCENARIO SELECTION
                             ======================================== -->

                        <!-- Scenario Selection -->
                        <div class="form-group">
                            <label for="scenario">
                                Scenario <span class="required">*</span>
                            </label>
                            <select id="scenario" v-model="selection.scenario" required>
                                <option value="">-- Select Scenario --</option>
                                <option v-for="(config, key) in testConfig.scenarioConfig" :key="key" :value="key">
                                    {{ config.label }}
                                </option>
                            </select>
                            <small v-if="selectedScenario">
                                {{ selectedScenario.description }}
                            </small>
                        </div>

                        <!-- ========================================
                             DYNAMIC SCENARIO FIELDS
                             ======================================== -->

                        <div v-if="selection.scenario" class="field-group">
                            <h3 class="field-group-title">
                                üéØ Scenario Configuration
                            </h3>

                            <div class="field-group-content">
                                <!-- No fields message -->
                                <div v-if="scenarioConfigFields.length === 0" class="no-fields">
                                    <p>‚úì No additional configuration required for this scenario</p>
                                </div>

                                <!-- Dynamic scenario fields -->
                                <div v-for="field in scenarioConfigFields" :key="field.name"
                                    :class="['form-group', field.type === 'checkbox' ? 'checkbox-group' : '']">
                                    <!-- Number Input -->
                                    <template v-if="field.type === 'number'">
                                        <label :for="'scenario-' + field.name">
                                            {{ field.label }}
                                            <span v-if="field.unit" class="field-unit">({{ field.unit }})</span>
                                        </label>
                                        <input :id="'scenario-' + field.name" type="number"
                                            v-model.number="scenarioData[field.name]" :min="field.min">
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>

                                    <!-- Text Input -->
                                    <template v-if="field.type === 'text' || field.type === 'string'">
                                        <label :for="'scenario-' + field.name">
                                            {{ field.label }}
                                        </label>
                                        <input :id="'scenario-' + field.name" type="text"
                                            v-model="scenarioData[field.name]">
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>

                                    <!-- Checkbox -->
                                    <template v-if="field.type === 'checkbox' || field.type === 'boolean'">
                                        <label :for="'scenario-' + field.name" class="checkbox-label">
                                            <input :id="'scenario-' + field.name" type="checkbox"
                                                v-model="scenarioData[field.name]">
                                            <span class="checkbox-text">{{ field.label }}</span>
                                        </label>
                                        <small v-if="field.help">{{ field.help }}</small>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- ========================================
                             SUBMIT BUTTON
                             ======================================== -->

                        <button type="submit" class="btn btn-primary"
                            :disabled="isSubmitting || !isFormValid || hasValidationErrors">
                            <span v-if="!isSubmitting">‚ñ∂Ô∏è Run Performance Test</span>
                            <span v-else>‚è≥ Triggering...</span>
                        </button>
                    </form>
                </section>

                <!-- Configuration Output -->
                <section class="output-section">
                    <div class="output-header">
                        <h2>Generated Configuration</h2>

                        <!-- Format Selector -->
                        <div class="format-selector">
                            <label class="format-option">
                                <input type="radio" name="output-format" value="json" v-model="outputFormat">
                                <span>JSON</span>
                            </label>
                            <label class="format-option">
                                <input type="radio" name="output-format" value="env" v-model="outputFormat">
                                <span>ENV</span>
                            </label>
                        </div>
                    </div>

                    <div class="output-container">
                        <pre class="output-content">{{ formattedOutput }}</pre>
                        <button type="button" class="btn-icon" @click="copyOutput"
                            :title="'Copy ' + outputFormat.toUpperCase()">
                            {{ copyButtonText }}
                        </button>
                    </div>

                    <!-- Format Help -->
                    <div class="output-help" v-if="outputFormat === 'env'">
                        <small>
                            üí° <strong>Usage:</strong>
                            <code>source config.env</code> or
                            <code>export $(cat config.env | xargs)</code>
                        </small>
                    </div>
                </section>

                <!-- Status Section -->
                <section class="status-section" v-if="status.visible">
                    <h2>Status</h2>
                    <div class="status-content" :class="'status-' + status.type" v-html="status.message"></div>
                </section>
            </main>

            <footer>
                <p>
                    Powered by GitHub Actions |
                    <a :href="'https://github.com/' + config.REPO_OWNER + '/perf-runner-ui'" target="_blank"
                        rel="noopener">
                        View Source
                    </a>
                </p>
            </footer>
        </div>

        <!-- Token Modal -->
        <div class="modal" v-if="modal.visible" @click.self="closeModal">
            <div class="modal-content">
                <h3>‚ö†Ô∏è GitHub Token Required</h3>
                <p>To trigger GitHub Actions, you need to provide a Personal Access Token.</p>

                <div class="form-group">
                    <label for="github-token">GitHub Personal Access Token</label>
                    <input type="password" id="github-token" v-model="modal.tokenInput" @keyup.enter="saveToken"
                        placeholder="ghp_xxxxxxxxxxxx">
                    <small>
                        <a href="https://github.com/settings/tokens/new?scopes=repo,workflow&description=Perf%20Test%20Runner"
                            target="_blank" rel="noopener">
                            Generate token
                        </a> with <code>repo</code> and <code>workflow</code> scopes
                    </small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" @click="closeModal">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" @click="saveToken">
                        Save Token
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Vue.js 3 from CDN -->
    <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>

    <!-- Configuration -->
    <script src="js/config.js"></script>

    <!-- Vue Application -->
    <script src="js/app.js"></script>
</body>

</html>